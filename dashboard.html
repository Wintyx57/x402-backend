<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>x402 Bazaar - Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: #0a0a0f;
            color: #e0e6ed;
            min-height: 100vh;
        }

        /* --- HEADER --- */
        .header {
            background: rgba(255,255,255,0.03);
            border-bottom: 1px solid rgba(255,255,255,0.08);
            padding: 16px 32px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            backdrop-filter: blur(12px);
        }

        .header-left { display: flex; align-items: center; gap: 16px; }

        .header-left h1 {
            font-size: 22px;
            font-weight: 700;
            background: linear-gradient(135deg, #FF9900, #FEBD69);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-left p { font-size: 13px; color: #64748b; }

        .live-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            background: rgba(52,211,153,0.1);
            border: 1px solid rgba(52,211,153,0.2);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            color: #34D399;
            font-weight: 600;
        }

        .live-dot {
            width: 8px; height: 8px;
            background: #34D399;
            border-radius: 50%;
            position: relative;
        }

        .live-dot::before {
            content: '';
            position: absolute;
            inset: -3px;
            border-radius: 50%;
            background: #34D399;
            opacity: 0;
            animation: ping 2s cubic-bezier(0,0,0.2,1) infinite;
        }

        @keyframes ping {
            0% { opacity: 0.75; transform: scale(1); }
            75%, 100% { opacity: 0; transform: scale(2); }
        }

        /* --- LAYOUT --- */
        .container { max-width: 1280px; margin: 0 auto; padding: 24px; }

        /* --- GLASS CARD --- */
        .glass {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.10);
            border-radius: 16px;
            transition: border-color 0.2s;
        }

        .glass:hover { border-color: rgba(255,255,255,0.18); }

        /* --- WALLET HERO --- */
        .wallet-hero {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,153,0,0.2);
            border-radius: 20px;
            padding: 32px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 40px rgba(255,153,0,0.08), 0 0 80px rgba(255,153,0,0.04);
        }

        .wallet-hero::before {
            content: '';
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 500px; height: 300px;
            background: radial-gradient(ellipse, rgba(255,153,0,0.06) 0%, transparent 70%);
            pointer-events: none;
        }

        .wallet-hero .label {
            font-size: 13px;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .wallet-hero .label svg { width: 20px; height: 20px; color: #FF9900; }

        .wallet-hero .balance {
            font-size: 48px;
            font-weight: 800;
            background: linear-gradient(135deg, #FF9900, #FEBD69);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 16px;
            line-height: 1.1;
            position: relative;
        }

        .wallet-hero .balance .unit {
            font-size: 20px;
            font-weight: 400;
            -webkit-text-fill-color: #94a3b8;
        }

        .wallet-meta {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 12px;
            position: relative;
        }

        .wallet-address {
            font-family: 'JetBrains Mono', 'Fira Code', monospace;
            font-size: 13px;
            color: #94a3b8;
            background: rgba(255,255,255,0.05);
            padding: 6px 12px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background 0.2s;
        }

        .wallet-address:hover { background: rgba(255,255,255,0.10); }

        .wallet-address .copy-icon { width: 14px; height: 14px; color: #64748b; }
        .wallet-address .copy-ok { color: #34D399; font-size: 12px; display: none; }

        .network-badge {
            background: rgba(59,130,246,0.1);
            border: 1px solid rgba(59,130,246,0.2);
            color: #60A5FA;
            padding: 4px 12px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
        }

        .explorer-link {
            font-size: 12px;
            color: #64748b;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: color 0.2s;
        }

        .explorer-link:hover { color: #FF9900; }
        .explorer-link svg { width: 14px; height: 14px; }

        /* --- STATS ROW --- */
        .stats-row {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat-card {
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .stat-icon {
            width: 40px; height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .stat-icon svg { width: 20px; height: 20px; }

        .stat-icon.green { background: rgba(52,211,153,0.1); color: #34D399; }
        .stat-icon.blue { background: rgba(96,165,250,0.1); color: #60A5FA; }
        .stat-icon.orange { background: rgba(255,153,0,0.1); color: #FF9900; }
        .stat-icon.amber { background: rgba(251,191,36,0.1); color: #FBBF24; }
        .stat-icon.emerald { background: rgba(52,211,153,0.1); color: #34D399; }

        .stat-value {
            font-size: 22px;
            font-weight: 700;
            color: #fff;
            line-height: 1.2;
        }

        .stat-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            color: #64748b;
        }

        /* --- GRID LAYOUT --- */
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 16px;
        }

        .grid-main {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 16px;
            margin-bottom: 16px;
        }

        /* --- PANEL --- */
        .panel-header {
            padding: 16px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.06);
            font-size: 14px;
            font-weight: 600;
            color: #94a3b8;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .panel-header .icon { margin-right: 8px; width: 16px; height: 16px; color: #FF9900; }

        .count-badge {
            background: rgba(255,153,0,0.1);
            color: #FF9900;
            padding: 2px 10px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: 600;
        }

        /* --- SERVICES TABLE --- */
        .services-table { width: 100%; border-collapse: collapse; }

        .services-table th {
            text-align: left;
            padding: 10px 16px;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #475569;
            border-bottom: 1px solid rgba(255,255,255,0.06);
        }

        .services-table td {
            padding: 12px 16px;
            font-size: 13px;
            border-bottom: 1px solid rgba(255,255,255,0.03);
            vertical-align: top;
        }

        .services-table tr { transition: background 0.15s; }
        .services-table tr:hover { background: rgba(255,255,255,0.03); }

        .service-name { font-weight: 600; color: #f1f5f9; }
        .service-desc { color: #64748b; font-size: 12px; margin-top: 2px; }
        .service-price { color: #34D399; font-weight: 600; font-family: monospace; }
        .service-owner { font-family: monospace; font-size: 11px; color: #64748b; }

        .tag {
            display: inline-block;
            background: rgba(255,255,255,0.06);
            color: #94a3b8;
            padding: 2px 8px;
            border-radius: 6px;
            font-size: 11px;
            margin: 1px 2px;
        }

        /* --- ACTIVITY --- */
        .activity-list { max-height: 560px; overflow-y: auto; }

        .activity-item {
            padding: 12px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.04);
            display: flex;
            align-items: flex-start;
            gap: 12px;
            transition: background 0.15s;
        }

        .activity-item:hover { background: rgba(255,255,255,0.02); }

        .activity-icon {
            width: 32px; height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .activity-icon svg { width: 16px; height: 16px; }

        .activity-icon.payment { background: rgba(52,211,153,0.1); color: #34D399; }
        .activity-icon.api_call { background: rgba(96,165,250,0.1); color: #60A5FA; }
        .activity-icon.error { background: rgba(248,113,113,0.1); color: #F87171; }

        .activity-content { flex: 1; min-width: 0; }
        .activity-detail { font-size: 13px; color: #e0e6ed; }
        .activity-time { font-size: 11px; color: #475569; margin-top: 2px; }
        .activity-amount { font-size: 13px; font-family: monospace; color: #34D399; font-weight: 600; flex-shrink: 0; }

        .tx-link {
            font-size: 11px;
            color: #64748b;
            text-decoration: none;
            transition: color 0.2s;
            flex-shrink: 0;
        }

        .tx-link:hover { color: #FF9900; }

        .service-tx a {
            color: #60A5FA;
            text-decoration: none;
            font-family: monospace;
            font-size: 11px;
        }

        .service-tx a:hover { text-decoration: underline; }

        /* --- EMPTY --- */
        .empty { text-align: center; padding: 40px; color: #475569; font-size: 14px; }

        /* --- SCROLLBAR --- */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.08); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.15); }

        /* --- RESPONSIVE --- */
        @media (max-width: 1024px) {
            .stats-row { grid-template-columns: repeat(3, 1fr); }
            .grid-main { grid-template-columns: 1fr; }
            .grid-2 { grid-template-columns: 1fr; }
        }

        @media (max-width: 640px) {
            .stats-row { grid-template-columns: repeat(2, 1fr); }
            .header { padding: 12px 16px; flex-direction: column; gap: 8px; }
            .container { padding: 12px; }
            .wallet-hero { padding: 20px; }
            .wallet-hero .balance { font-size: 36px; }
        }

        /* --- FADE IN --- */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in { animation: fadeIn 0.5s ease-out both; }
    </style>
</head>
<body>

    <!-- HEADER -->
    <div class="header">
        <div class="header-left">
            <h1>x402 Bazaar</h1>
            <p>Admin Dashboard</p>
        </div>
        <div class="live-badge">
            <span class="live-dot"></span>
            LIVE
        </div>
    </div>

    <div class="container">

        <!-- WALLET HERO -->
        <div class="wallet-hero fade-in">
            <div class="label">
                <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a2.25 2.25 0 00-2.25-2.25H15a3 3 0 110-6h5.25A2.25 2.25 0 0121 6v6zm0 0v6a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 18V6a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 6" />
                </svg>
                Treasury Balance
            </div>
            <div class="balance" id="wallet-balance">$â€” <span class="unit">USDC</span></div>
            <div class="wallet-meta">
                <div class="wallet-address" id="wallet-address" onclick="copyAddress()" title="Click to copy">
                    <span id="wallet-addr-text">...</span>
                    <svg class="copy-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15.666 3.888A2.25 2.25 0 0013.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 01-.75.75H9.75a.75.75 0 01-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 01-2.25 2.25H6.75A2.25 2.25 0 014.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 011.927-.184" />
                    </svg>
                    <span class="copy-ok" id="copy-ok">Copied!</span>
                </div>
                <span class="network-badge" id="network-badge">Base</span>
                <a class="explorer-link" id="explorer-link" href="#" target="_blank">
                    View on Explorer
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 003 8.25v10.5A2.25 2.25 0 005.25 21h10.5A2.25 2.25 0 0018 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25" />
                    </svg>
                </a>
            </div>
        </div>

        <!-- STATS ROW -->
        <div class="stats-row">
            <div class="glass stat-card fade-in" style="animation-delay:0.05s">
                <div class="stat-icon green">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18L9 11.25l4.306 4.307a11.95 11.95 0 015.814-5.519l2.74-1.22m0 0l-5.94-2.28m5.94 2.28l-2.28 5.941" />
                    </svg>
                </div>
                <div>
                    <div class="stat-value" id="stat-revenue">$0.00</div>
                    <div class="stat-label">Revenue</div>
                </div>
            </div>
            <div class="glass stat-card fade-in" style="animation-delay:0.1s">
                <div class="stat-icon blue">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M7.5 21L3 16.5m0 0L7.5 12M3 16.5h13.5m0-13.5L21 7.5m0 0L16.5 12M21 7.5H7.5" />
                    </svg>
                </div>
                <div>
                    <div class="stat-value" id="stat-payments">0</div>
                    <div class="stat-label">Transactions</div>
                </div>
            </div>
            <div class="glass stat-card fade-in" style="animation-delay:0.15s">
                <div class="stat-icon orange">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25 2.25H6A2.25 2.25 0 013.75 18v-2.25zM13.5 6a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 10.5h-2.25a2.25 2.25 0 01-2.25-2.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-2.25A2.25 2.25 0 0113.5 18v-2.25z" />
                    </svg>
                </div>
                <div>
                    <div class="stat-value" id="stat-services">0</div>
                    <div class="stat-label">Services</div>
                </div>
            </div>
            <div class="glass stat-card fade-in" style="animation-delay:0.2s">
                <div class="stat-icon emerald">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                </div>
                <div>
                    <div class="stat-value" id="stat-active">0</div>
                    <div class="stat-label">Active</div>
                </div>
            </div>
            <div class="glass stat-card fade-in" style="animation-delay:0.25s">
                <div class="stat-icon amber">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9.568 3H5.25A2.25 2.25 0 003 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 005.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 009.568 3z" />
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 6h.008v.008H6V6z" />
                    </svg>
                </div>
                <div>
                    <div class="stat-value" id="stat-avgprice">$0</div>
                    <div class="stat-label">Avg Price</div>
                </div>
            </div>
        </div>

        <!-- SYSTEM INFO ROW -->
        <div class="grid-2 fade-in" style="animation-delay:0.28s">
            <div class="glass" style="padding:20px">
                <div style="font-size:13px;color:#94a3b8;text-transform:uppercase;letter-spacing:1px;margin-bottom:16px;display:flex;align-items:center;gap:8px">
                    <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="#FF9900" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285z" />
                    </svg>
                    Monitoring & Quality
                </div>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px">
                    <div>
                        <div style="font-size:24px;font-weight:700;color:#34D399" id="sys-monitoring">61/61</div>
                        <div style="font-size:11px;color:#64748b;text-transform:uppercase;letter-spacing:0.5px">Endpoints Online</div>
                    </div>
                    <div>
                        <div style="font-size:24px;font-weight:700;color:#fff">416</div>
                        <div style="font-size:11px;color:#64748b;text-transform:uppercase;letter-spacing:0.5px">Tests Passing</div>
                    </div>
                    <div>
                        <div style="font-size:24px;font-weight:700;color:#60A5FA">61</div>
                        <div style="font-size:11px;color:#64748b;text-transform:uppercase;letter-spacing:0.5px">Native APIs</div>
                    </div>
                    <div>
                        <div style="font-size:24px;font-weight:700;color:#FBBF24">6</div>
                        <div style="font-size:11px;color:#64748b;text-transform:uppercase;letter-spacing:0.5px">Integrations</div>
                    </div>
                </div>
            </div>
            <div class="glass" style="padding:20px">
                <div style="font-size:13px;color:#94a3b8;text-transform:uppercase;letter-spacing:1px;margin-bottom:16px;display:flex;align-items:center;gap:8px">
                    <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="#FF9900" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 011.242 7.244l-4.5 4.5a4.5 4.5 0 01-6.364-6.364l1.757-1.757m9.86-2.56a4.5 4.5 0 00-1.242-7.244l4.5-4.5a4.5 4.5 0 016.364 6.364l-1.757 1.757" />
                    </svg>
                    Integrations
                </div>
                <div style="display:flex;flex-direction:column;gap:10px">
                    <div style="display:flex;align-items:center;gap:10px;padding:8px 12px;background:rgba(255,255,255,0.03);border-radius:8px">
                        <span style="width:8px;height:8px;border-radius:50%;background:#34D399"></span>
                        <span style="font-size:13px;color:#e0e6ed;flex:1">MCP Server (Claude/Cursor)</span>
                        <span style="font-size:11px;color:#34D399;font-weight:600">v2.1.0</span>
                    </div>
                    <div style="display:flex;align-items:center;gap:10px;padding:8px 12px;background:rgba(255,255,255,0.03);border-radius:8px">
                        <span style="width:8px;height:8px;border-radius:50%;background:#34D399"></span>
                        <span style="font-size:13px;color:#e0e6ed;flex:1">ChatGPT Custom GPT</span>
                        <span style="font-size:11px;color:#34D399;font-weight:600">30 ops</span>
                    </div>
                    <div style="display:flex;align-items:center;gap:10px;padding:8px 12px;background:rgba(255,255,255,0.03);border-radius:8px">
                        <span style="width:8px;height:8px;border-radius:50%;background:#34D399"></span>
                        <span style="font-size:13px;color:#e0e6ed;flex:1">CLI npm (x402-bazaar)</span>
                        <span style="font-size:11px;color:#34D399;font-weight:600">v3.0.0</span>
                    </div>
                    <div style="display:flex;align-items:center;gap:10px;padding:8px 12px;background:rgba(255,255,255,0.03);border-radius:8px">
                        <span style="width:8px;height:8px;border-radius:50%;background:#34D399"></span>
                        <span style="font-size:13px;color:#e0e6ed;flex:1">Telegram Bot</span>
                        <span style="font-size:11px;color:#34D399;font-weight:600" id="sys-telegram">Active</span>
                    </div>
                    <div style="display:flex;align-items:center;gap:10px;padding:8px 12px;background:rgba(255,255,255,0.03);border-radius:8px">
                        <span style="width:8px;height:8px;border-radius:50%;background:#34D399"></span>
                        <span style="font-size:13px;color:#e0e6ed;flex:1">LangChain (Python)</span>
                        <span style="font-size:11px;color:#34D399;font-weight:600">v0.1.0</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- SERVICES + ACTIVITY -->
        <div class="grid-main">
            <!-- SERVICES TABLE -->
            <div class="glass fade-in" style="animation-delay:0.3s">
                <div class="panel-header">
                    <span>
                        <svg class="icon" style="display:inline;vertical-align:middle;margin-right:6px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5" width="16" height="16">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6z" />
                        </svg>
                        Services enregistres
                    </span>
                    <span class="count-badge" id="services-count">0</span>
                </div>
                <div id="services-body" style="max-height:500px;overflow-y:auto">
                    <div class="empty">Chargement...</div>
                </div>
            </div>

            <!-- ACTIVITY LOG -->
            <div class="glass fade-in" style="animation-delay:0.35s">
                <div class="panel-header">
                    <span>
                        <svg class="icon" style="display:inline;vertical-align:middle;margin-right:6px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5" width="16" height="16">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 010 3.75H5.625a1.875 1.875 0 010-3.75z" />
                        </svg>
                        Activite en temps reel
                    </span>
                    <span class="count-badge" id="activity-count">0</span>
                </div>
                <div class="activity-list" id="activity-body">
                    <div class="empty">En attente d'activite...</div>
                </div>
            </div>
        </div>

    </div>

    <script>
        let fullWalletAddress = '';
        let adminToken = sessionStorage.getItem('x402_admin_token') || '';

        // --- AUTH: prompt for token if needed ---
        async function checkAuth() {
            if (!adminToken) {
                adminToken = prompt('Admin Token:');
                if (!adminToken) { document.body.innerHTML = '<div style="display:flex;align-items:center;justify-content:center;height:100vh;color:#ef4444;font-size:18px">Access denied</div>'; return false; }
            }
            // Test the token
            const res = await fetch('/api/stats', { headers: { 'X-Admin-Token': adminToken } });
            if (res.status === 401) {
                sessionStorage.removeItem('x402_admin_token');
                adminToken = '';
                document.body.innerHTML = '<div style="display:flex;align-items:center;justify-content:center;height:100vh;color:#ef4444;font-size:18px">Invalid token. Reload to retry.</div>';
                return false;
            }
            sessionStorage.setItem('x402_admin_token', adminToken);
            return true;
        }

        function authHeaders() {
            return adminToken ? { 'X-Admin-Token': adminToken } : {};
        }

        function timeAgo(isoStr) {
            const diff = Math.floor((Date.now() - new Date(isoStr).getTime()) / 1000);
            if (diff < 5) return "a l'instant";
            if (diff < 60) return `il y a ${diff}s`;
            if (diff < 3600) return `il y a ${Math.floor(diff / 60)}min`;
            if (diff < 86400) return `il y a ${Math.floor(diff / 3600)}h`;
            return `il y a ${Math.floor(diff / 86400)}j`;
        }

        function copyAddress() {
            if (!fullWalletAddress) return;
            navigator.clipboard.writeText(fullWalletAddress);
            const ok = document.getElementById('copy-ok');
            ok.style.display = 'inline';
            setTimeout(() => { ok.style.display = 'none'; }, 2000);
        }

        function esc(str) {
            const d = document.createElement('div');
            d.textContent = str;
            return d.innerHTML;
        }

        const ACTIVITY_ICONS = {
            payment: '<svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v12m-3-2.818l.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>',
            api_call: '<svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17.25 6.75L22.5 12l-5.25 5.25m-10.5 0L1.5 12l5.25-5.25m7.5-3l-4.5 16.5" /></svg>',
            error: '<svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z" /></svg>',
        };

        async function refreshAnalytics() {
            try {
                const res = await fetch('/api/analytics', { headers: authHeaders() });
                const d = await res.json();

                // Balance
                const balEl = document.getElementById('wallet-balance');
                if (d.walletBalance != null) {
                    balEl.textContent = '';
                    balEl.innerHTML = `$${d.walletBalance.toFixed(2)} <span class="unit">USDC</span>`;
                }

                // Wallet address
                if (d.walletAddress) {
                    fullWalletAddress = d.walletAddress;
                    document.getElementById('wallet-addr-text').textContent =
                        `${d.walletAddress.slice(0,6)}...${d.walletAddress.slice(-4)}`;
                }

                // Network
                if (d.network) {
                    document.getElementById('network-badge').textContent = d.network;
                }

                // Explorer link
                if (d.explorer && d.walletAddress) {
                    const el = document.getElementById('explorer-link');
                    el.href = `${d.explorer}/address/${d.walletAddress}`;
                }

                // Stats
                document.getElementById('stat-revenue').textContent = `$${d.totals?.revenue?.toFixed(2) || '0.00'}`;
                document.getElementById('stat-payments').textContent = d.totals?.transactions?.toLocaleString() || '0';
                document.getElementById('stat-services').textContent = d.totals?.services || '0';
                document.getElementById('stat-active').textContent = d.activeServicesCount || '0';
                document.getElementById('stat-avgprice').textContent = d.avgPrice ? `$${d.avgPrice}` : '$0';

                // Recent Activity
                if (d.recentActivity && d.recentActivity.length > 0) {
                    const explorer = d.explorer || 'https://basescan.org';
                    const items = d.recentActivity.map(a => {
                        const icon = ACTIVITY_ICONS[a.type] || ACTIVITY_ICONS.api_call;
                        const amountHtml = a.amount ? `<span class="activity-amount">$${Number(a.amount).toFixed(3)}</span>` : '';
                        const txHtml = a.txHash
                            ? `<a class="tx-link" href="${explorer}/tx/${a.txHash}" target="_blank" title="${a.txHash}">tx&#8599;</a>`
                            : '';
                        return `
                        <div class="activity-item">
                            <div class="activity-icon ${a.type}">${icon}</div>
                            <div class="activity-content">
                                <div class="activity-detail">${esc(a.detail || '')}</div>
                                <div class="activity-time">${timeAgo(a.time)}</div>
                            </div>
                            ${amountHtml}
                            ${txHtml}
                        </div>`;
                    }).join('');
                    document.getElementById('activity-body').innerHTML = items;
                    document.getElementById('activity-count').textContent = d.recentActivity.length;
                }
            } catch (e) { console.error('Analytics refresh error:', e); }
        }

        async function refreshServices() {
            try {
                const res = await fetch('/api/services');
                const services = await res.json();
                document.getElementById('services-count').textContent = services.length;

                if (services.length === 0) {
                    document.getElementById('services-body').innerHTML =
                        '<div class="empty">Aucun service enregistre.</div>';
                    return;
                }

                const rows = services.map(s => {
                    const txCell = s.tx_hash
                        ? `<a href="https://basescan.org/tx/${s.tx_hash}" target="_blank" style="color:#60A5FA;text-decoration:none;font-family:monospace;font-size:11px">${s.tx_hash.slice(0,10)}...</a>`
                        : '<span style="color:#475569;font-size:11px">-</span>';
                    return `
                    <tr>
                        <td>
                            <div class="service-name">${esc(s.name)}</div>
                            <div class="service-desc">${esc(s.description || '')}</div>
                        </td>
                        <td class="service-price">${s.price_usdc} USDC</td>
                        <td>${(s.tags || []).map(t => `<span class="tag">${esc(t)}</span>`).join('')}</td>
                        <td class="service-owner">${esc((s.owner_address || '').slice(0,10))}...</td>
                        <td>${txCell}</td>
                        <td style="font-size:12px;color:#64748b">${timeAgo(s.created_at)}</td>
                    </tr>`;
                }).join('');

                document.getElementById('services-body').innerHTML = `
                    <table class="services-table">
                        <thead><tr>
                            <th>Service</th><th>Prix</th><th>Tags</th><th>Owner</th><th>Preuve</th><th>Date</th>
                        </tr></thead>
                        <tbody>${rows}</tbody>
                    </table>`;
            } catch (e) { console.error('Services refresh error:', e); }
        }

        async function refreshMonitoring() {
            try {
                const res = await fetch('/api/public-stats');
                const d = await res.json();
                if (d.monitoring) {
                    const el = document.getElementById('sys-monitoring');
                    if (el) {
                        el.textContent = `${d.monitoring.online}/${d.monitoring.total}`;
                        el.style.color = d.monitoring.online === d.monitoring.total ? '#34D399' : '#FBBF24';
                    }
                }
            } catch { /* ignore */ }
        }

        // Refresh loop
        async function refresh() {
            await Promise.all([refreshAnalytics(), refreshServices(), refreshMonitoring()]);
        }

        (async () => {
            const ok = await checkAuth();
            if (!ok) return;
            refresh();
            setInterval(refresh, 5000);
        })();
    </script>

</body>
</html>
